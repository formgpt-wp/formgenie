document.querySelectorAll("form").forEach(e=>{let r=document.createElement("button");r.classList.add("magic-form-mic"),r.innerHTML="\uD83C\uDFA4",r.addEventListener("click",handleMicClick);let t=e.querySelector("input");e.insertBefore(r,t)});let isRecording=!1,chunks=[],mediaRecorder;function handleMicClick(e){isRecording?(mediaRecorder.stop(),isRecording=!1,e.target.classList.remove("recording"),sendAudio(e.target.form,chunks),chunks=[]):navigator.mediaDevices.getUserMedia({audio:!0}).then(r=>{(mediaRecorder=new MediaRecorder(r)).start(),isRecording=!0,e.target.classList.add("recording"),mediaRecorder.ondataavailable=e=>{chunks.push(e.data)}}).catch(e=>{console.error("Could not get user media",e)})}function grabFormData(e){let r=new FormData(e);return[...r.entries()]}function sendAudio(e,r){let t=new Blob(r,{type:"audio/ogg; codecs=opus"}),a=grabFormData(e),c=new FormData;c.append("audio",t),c.append("form",JSON.stringify(a)),fetch("/url-to-handle-data",{method:"POST",body:c}).then(e=>e.json()).then(r=>{Object.entries(r).forEach(([r,t])=>{let a=e.querySelector(`[name=${r}]`);if(a)switch(a.type){case"text":case"textarea":case"password":case"email":a.value=t;break;case"select-one":for(let c=0;c<a.options.length;c++)if(a.options[c].value===t){a.selectedIndex=c;break}break;case"radio":case"checkbox":Array.isArray(t)?t.forEach(e=>{a.value===e&&(a.checked=!0)}):a.value===t&&(a.checked=!0)}}),event.target.classList.remove("recording"),event.target.classList.add("complete"),setTimeout(()=>{event.target.classList.remove("complete")},3e3)}).catch(e=>{console.error("An error occurred",e),event.target.classList.remove("recording")})}